!function(t,i,e){"use strict";function a(t){this.image=t,this.canvas=null,this.x=0,this.y=0,this.prevX=0,this.prevY=0,this.width=0,this.height=0}function n(){var i=t("#image-canvas")[0],e=t("canvas"),n=e.width(),o=e.height();s=new a,s.image=this,s.canvas=i,s.changeSize(this.width,this.height,n),s.y=Math.floor(o/2-s.height/2),s.x=Math.floor(n/2-s.width/2),s.draw(),t("#opacity-label").text("Opacity: 100%"),t(".setting").each(function(t,i){i.disabled=!1}).filter("#size").each(function(t,i){var e=this.width,a=s.width;i.min=.1*e,a>e?i.max=a:i.max=this.height,i.value=a,r("#size-label","size: ",this.width/a)}.bind(this)).on("input",function(t){var i=t.target.value,e=s.width,a=s.height;s.changeSize(this.width,this.height,i),s.x-=h(s.width,e)/2,s.y-=h(s.height,a)/2,s.draw(),r("#size-label","size: ",i/this.width)}.bind(this)).end().filter("#opacity").on("input",function(i){var e=i.target.value;t("#opacity-label").text("Opacity: "+Math.floor(100*e)+"%"),s.canvas.getContext("2d").globalAlpha=e,s.draw()}).end().filter("#filter").change(function(i){var e=t("#filter-canvas"),a=e[0].getContext("2d");a.fillStyle=i.target.value,a.fillRect(0,0,n,o)}).end().filter("#clear").click(function(){var i=t("#filter-canvas")[0].getContext("2d");i.clearRect(0,0,n,o)}).end().filter("#filter-opacity").each(function(i,e){var a=e.value;t("#filter-canvas")[0].getContext("2d").globalAlpha=a,r("#filter-opacity-label","Colour Opacity: ",a)}).on("input",function(i){var e=t("#filter-canvas"),a=e[0].getContext("2d"),h=i.target.value;a.globalAlpha=h,a.clearRect(0,0,n,o),a.fillRect(0,0,n,o),r("#filter-opacity-label","Colour Opacity: ",h)}).end().filter("#upload").click(function(){for(var i=t(".canvas"),e=t("#hidden-canvas"),a=e.getContext("2d"),n=0;n<i.length;n++)a.drawImage(i[n],0,0);console.log(e.toDataURL())})}function h(t,i){return t>i?Math.floor(t-i):Math.floor(-(i-t))}function r(i,e,a){var n=Math.floor(100*a);t(i).text(e+n+"%")}a.prototype.changeSize=function(t,i,e){if(e>t&&e>i)return this.width=this.image.width,void(this.height=this.image.height);var a=i/t,n=Math.ceil(a*e);if(n>e){var h=t/i,r=Math.ceil(h*e);this.width=r,this.height=e}else this.width=e,this.height=n},a.prototype.setPos=function(t,i){this.x=t,this.y=i},a.prototype.draw=function(i,e,a,n){i=i||this.x,e=e||this.y,a=a||this.width,n=n||this.height;var h=t(this.canvas),r=this.canvas.getContext("2d");r.clearRect(0,0,h.width(),h.height()),console.log(a,n),r.drawImage(this.image,i,e,a,n)};var o=function(i){return function(e){var a,n=t(".username").val(),h=t(".password").val();if("login"==i)a={username:n,password:h};else if("register"==i){var r=t(".confirm").val();if(confim!=h)return t("#error").val("passwords don't match."),!1;a={username:n,password:h,confirm:r}}return t.ajax({url:"/users/"+i,method:"POST",data:a,success:function(t){}}),!1}};t("#login").submit(o("login")),t("#register").submit(o("register"));var s=new a,c=!1;t("canvas").each(function(i,e){var a=t(e);t(".canvas-container").height(a.parent().width()),e.width=a.parent().width(),e.height=a.parent().width()}).filter("#image-canvas").mousedown(function(){c=!0}).mouseup(function(){c=!1}).mousemove(function(t){s.image&&c&&(s.x+=h(t.clientX,s.prevX),s.y+=h(t.clientY,s.prevY),s.draw()),s.prevX=t.clientX,s.prevY=t.clientY}),t("#file").change(function(t){var i=t.target.files[0],e=new Image;e.onload=n,e.src=URL.createObjectURL(i)})}($,window,document);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImR5bmFtaWNJbWFnZS5qcyIsImNhbnZhcy5qcyIsInNjcmlwdC5qcyIsImZvcm1zLmpzIl0sIm5hbWVzIjpbIiQiLCJ3aW5kb3ciLCJkb2N1bWVudCIsIkR5SW1hZ2UiLCJpbWFnZSIsInRoaXMiLCJjYW52YXMiLCJ4IiwieSIsInByZXZYIiwicHJldlkiLCJ3aWR0aCIsImhlaWdodCIsIm9uSW1hZ2VMb2FkIiwiJGNhbnZhcyIsImNhbnZhc1dpZHRoIiwiY2FudmFzSGVpZ2h0IiwiZHlJbWFnZSIsImNoYW5nZVNpemUiLCJNYXRoIiwiZmxvb3IiLCJkcmF3IiwidGV4dCIsImVhY2giLCJfIiwiZWxlbWVudCIsImRpc2FibGVkIiwiZmlsdGVyIiwic2l6ZSIsImRXaWR0aCIsIm1pbiIsIm1heCIsInZhbHVlIiwiY2hhbmdlUGVyY2VudGFnZSIsImJpbmQiLCJvbiIsImV2ZW50IiwidGFyZ2V0Iiwib2xkV2lkdGgiLCJvbGRIZWlnaHQiLCJkaWZmIiwiZW5kIiwibmV3T3BhY2l0eSIsImdldENvbnRleHQiLCJnbG9iYWxBbHBoYSIsImNoYW5nZSIsImNvbnRleHQiLCJmaWxsU3R5bGUiLCJmaWxsUmVjdCIsImNsaWNrIiwiY2xlYXJSZWN0IiwiYWxwaGEiLCJjYW52YXNlcyIsImhpZGRlbkNhbnZhcyIsImhpZGRlbkNvbnRleHQiLCJpIiwibGVuZ3RoIiwiZHJhd0ltYWdlIiwiY29uc29sZSIsImxvZyIsInRvRGF0YVVSTCIsImEiLCJiIiwicGVyY2VudGFnZSIsInByb3RvdHlwZSIsImFzcGVjdFJhdGlvIiwibmV3SGVpZ2h0IiwiY2VpbCIsIm5ld0FzcGVjdFJhdGlvIiwibmV3V2lkdGgiLCJzZXRQb3MiLCJzdWJtaXQiLCJmb3JtVHlwZSIsImRhdGEiLCJ1c2VybmFtZSIsInZhbCIsInBhc3N3b3JkIiwiY29uZmlybSIsImNvbmZpbSIsImFqYXgiLCJ1cmwiLCJtZXRob2QiLCJzdWNjZXNzIiwiYXJndW1lbnQiLCJpc01vdXNlZG93biIsInBhcmVudCIsIm1vdXNlZG93biIsIm1vdXNldXAiLCJtb3VzZW1vdmUiLCJjbGllbnRYIiwiY2xpZW50WSIsImZpbGUiLCJmaWxlcyIsIkltYWdlIiwib25sb2FkIiwic3JjIiwiVVJMIiwiY3JlYXRlT2JqZWN0VVJMIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFBQSxFQUFBQyxFQUFBQyxHQUNBLFlBQ0EsU0FBQUMsR0FBQUMsR0FDQUMsS0FBQUQsTUFBQUEsRUFDQUMsS0FBQUMsT0FBQSxLQUNBRCxLQUFBRSxFQUFBLEVBQ0FGLEtBQUFHLEVBQUEsRUFDQUgsS0FBQUksTUFBQSxFQUNBSixLQUFBSyxNQUFBLEVBQ0FMLEtBQUFNLE1BQUEsRUFDQU4sS0FBQU8sT0FBQSxFQ3lCQSxRQUFBQyxLQUNBLEdBQUFQLEdBQUFOLEVBQUEsaUJBQUEsR0FDQWMsRUFBQWQsRUFBQSxVQUNBZSxFQUFBRCxFQUFBSCxRQUNBSyxFQUFBRixFQUFBRixRQUVBSyxHQUFBLEdBQUFkLEdBQ0FjLEVBQUFiLE1BQUFDLEtBQ0FZLEVBQUFYLE9BQUFBLEVBQ0FXLEVBQUFDLFdBQUFiLEtBQUFNLE1BQUFOLEtBQUFPLE9BQUFHLEdBQ0FFLEVBQUFULEVBQUFXLEtBQUFDLE1BQUFKLEVBQUEsRUFBQUMsRUFBQUwsT0FBQSxHQUNBSyxFQUFBVixFQUFBWSxLQUFBQyxNQUFBTCxFQUFBLEVBQUFFLEVBQUFOLE1BQUEsR0FDQU0sRUFBQUksT0FFQXJCLEVBQUEsa0JBQUFzQixLQUFBLGlCQUdBdEIsRUFBQSxZQUFBdUIsS0FBQSxTQUFBQyxFQUFBQyxHQUNBQSxFQUFBQyxVQUFBLElBR0FDLE9BQUEsU0FBQUosS0FBQSxTQUFBQyxFQUFBSSxHQUNBLEdBQUFqQixHQUFBTixLQUFBTSxNQUNBa0IsRUFBQVosRUFBQU4sS0FDQWlCLEdBQUFFLElBQUEsR0FBQW5CLEVBQ0FrQixFQUFBbEIsRUFDQWlCLEVBQUFHLElBQUFGLEVBRUFELEVBQUFHLElBQUExQixLQUFBTyxPQUVBZ0IsRUFBQUksTUFBQUgsRUFDQUksRUFBQSxjQUFBLFNBQUE1QixLQUFB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QUF0RCxHQUFBLEdBQUFkLEdBQ0FpRixHQUFBLENBRUFwRixHQUFBLFVBQ0F1QixLQUFBLFNBQUFnQyxFQUFBakQsR0FDQSxHQUFBUSxHQUFBZCxFQUFBTSxFQUNBTixHQUFBLHFCQUFBWSxPQUFBRSxFQUFBdUUsU0FBQTFFLFNBRUFMLEVBQUFLLE1BQUFHLEVBQUF1RSxTQUFBMUUsUUFDQUwsRUFBQU0sT0FBQUUsRUFBQXVFLFNBQUExRSxVQUVBZ0IsT0FBQSxpQkFDQTJELFVBQUEsV0FBQUYsR0FBQSxJQUNBRyxRQUFBLFdBQUFILEdBQUEsSUFDQUksVUFBQSxTQUFBcEQsR0FDQW5CLEVBQUFiLE9BQUFnRixJQUVBbkUsRUFBQVYsR0FBQWlDLEVBQUFKLEVBQUFxRCxRQUFBeEUsRUFBQVIsT0FDQVEsRUFBQVQsR0FBQWdDLEVBQUFKLEVBQUFzRCxRQUFBekUsRUFBQVAsT0FDQU8sRUFBQUksUUFHQUosRUFBQVIsTUFBQTJCLEVBQUFxRCxRQUNBeEUsRUFBQVAsTUFBQTBCLEVBQUFzRCxVQUdBMUYsRUFBQSxTQUFBNkMsT0FBQSxTQUFBVCxHQUNBLEdBQUF1RCxHQUFBdkQsRUFBQUMsT0FBQXVELE1BQUEsR0FDQXhGLEVBQUEsR0FBQXlGLE1BQ0F6RixHQUFBMEYsT0FBQWpGLEVBQ0FULEVBQUEyRixJQUFBQyxJQUFBQyxnQkFBQU4sTUMyTUczRixFQUFHQyxPQUFRQyIsImZpbGUiOiJzY3JpcHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBEeUltYWdlIChpbWFnZSkge1xyXG5cdHRoaXMuaW1hZ2UgPSBpbWFnZVxyXG5cdHRoaXMuY2FudmFzID0gbnVsbFxyXG5cdHRoaXMueCA9IDBcclxuXHR0aGlzLnkgPSAwXHJcblx0dGhpcy5wcmV2WCA9IDBcclxuXHR0aGlzLnByZXZZID0gMFxyXG5cdHRoaXMud2lkdGggPSAwXHJcblx0dGhpcy5oZWlnaHQgPSAwXHJcbn1cclxuXHJcbkR5SW1hZ2UucHJvdG90eXBlLmNoYW5nZVNpemUgPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCwgdGFyZ2V0KSB7XHJcblx0aWYgKHRhcmdldCA+IHdpZHRoICYmIHRhcmdldCA+IGhlaWdodCkge1xyXG5cdFx0dGhpcy53aWR0aCA9IHRoaXMuaW1hZ2Uud2lkdGhcclxuXHRcdHRoaXMuaGVpZ2h0ID0gdGhpcy5pbWFnZS5oZWlnaHRcclxuXHRcdHJldHVybjtcclxuXHR9XHJcblxyXG5cdHZhciBhc3BlY3RSYXRpbyA9IGhlaWdodCAvIHdpZHRoXHJcblx0ICAsIG5ld0hlaWdodCAgID0gTWF0aC5jZWlsKGFzcGVjdFJhdGlvICogdGFyZ2V0KVxyXG5cclxuXHRpZiAobmV3SGVpZ2h0ID4gdGFyZ2V0KSB7XHJcblx0XHR2YXIgbmV3QXNwZWN0UmF0aW8gPSB3aWR0aCAvIGhlaWdodFxyXG5cdFx0ICAsIG5ld1dpZHRoID0gTWF0aC5jZWlsKG5ld0FzcGVjdFJhdGlvICogdGFyZ2V0KVxyXG5cclxuXHRcdHRoaXMud2lkdGggPSBuZXdXaWR0aFxyXG5cdFx0dGhpcy5oZWlnaHQgPSB0YXJnZXRcclxuXHRcclxuXHR9IGVsc2Uge1xyXG5cdFx0dGhpcy53aWR0aCA9IHRhcmdldFxyXG5cdFx0dGhpcy5oZWlnaHQgPSBuZXdIZWlnaHRcclxuXHR9XHJcbn1cclxuXHJcbkR5SW1hZ2UucHJvdG90eXBlLnNldFBvcyA9IGZ1bmN0aW9uKHgsIHkpIHtcclxuXHR0aGlzLnggPSB4XHJcblx0dGhpcy55ID0geVxyXG59XHJcblxyXG5EeUltYWdlLnByb3RvdHlwZS5kcmF3ID0gZnVuY3Rpb24oeCwgeSwgd2lkdGgsIGhlaWdodCkge1xyXG5cdHggPSB4IHx8IHRoaXMueFxyXG5cdHkgPSB5IHx8IHRoaXMueVxyXG5cdHdpZHRoID0gd2lkdGggfHwgdGhpcy53aWR0aFxyXG5cdGhlaWdodCA9IGhlaWdodCB8fCB0aGlzLmhlaWdodFxyXG5cclxuXHR2YXIgJGNhbnZhcyA9ICQodGhpcy5jYW52YXMpXHJcblx0ICAsIGNvbnRleHQgPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpXHJcbiAgICBjb250ZXh0LmNsZWFyUmVjdCgwLCAwLCAkY2FudmFzLndpZHRoKCksICRjYW52YXMuaGVpZ2h0KCkpXHJcbiAgICBjb25zb2xlLmxvZyh3aWR0aCwgaGVpZ2h0KTtcclxuICAgIGNvbnRleHQuZHJhd0ltYWdlKHRoaXMuaW1hZ2UsIHgsIHksIHdpZHRoLCBoZWlnaHQpXHJcbn07IiwidmFyIGR5SW1hZ2UgPSBuZXcgRHlJbWFnZSgpXHJcbiAgLCBpc01vdXNlZG93biA9IGZhbHNlXHJcblxyXG4kKCdjYW52YXMnKVxyXG4uZWFjaChmdW5jdGlvbiAoaSwgY2FudmFzKSB7XHJcbiAgICB2YXIgJGNhbnZhcyA9ICQoY2FudmFzKVxyXG4gICAgJCgnLmNhbnZhcy1jb250YWluZXInKS5oZWlnaHQoJGNhbnZhcy5wYXJlbnQoKS53aWR0aCgpKVxyXG5cclxuICAgIGNhbnZhcy53aWR0aCA9ICRjYW52YXMucGFyZW50KCkud2lkdGgoKVxyXG4gICAgY2FudmFzLmhlaWdodCA9ICRjYW52YXMucGFyZW50KCkud2lkdGgoKVxyXG59KVxyXG4uZmlsdGVyKCcjaW1hZ2UtY2FudmFzJylcclxuLm1vdXNlZG93bihmdW5jdGlvbigpIHtpc01vdXNlZG93biA9IHRydWV9KVxyXG4ubW91c2V1cChmdW5jdGlvbigpIHtpc01vdXNlZG93biA9IGZhbHNlfSlcclxuLm1vdXNlbW92ZShmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgIGlmIChkeUltYWdlLmltYWdlICYmIGlzTW91c2Vkb3duKSB7XHJcblxyXG4gICAgICAgIGR5SW1hZ2UueCArPSBkaWZmKGV2ZW50LmNsaWVudFgsIGR5SW1hZ2UucHJldlgpXHJcbiAgICAgICAgZHlJbWFnZS55ICs9IGRpZmYoZXZlbnQuY2xpZW50WSwgZHlJbWFnZS5wcmV2WSlcclxuICAgICAgICBkeUltYWdlLmRyYXcoKVxyXG4gICAgfVxyXG5cclxuICAgIGR5SW1hZ2UucHJldlggPSBldmVudC5jbGllbnRYXHJcbiAgICBkeUltYWdlLnByZXZZID0gZXZlbnQuY2xpZW50WVxyXG59KVxyXG5cclxuJCgnI2ZpbGUnKS5jaGFuZ2UoZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICB2YXIgZmlsZSA9IGV2ZW50LnRhcmdldC5maWxlc1swXVxyXG4gICAgdmFyIGltYWdlID0gbmV3IEltYWdlKClcclxuICAgIGltYWdlLm9ubG9hZCA9IG9uSW1hZ2VMb2FkXHJcbiAgICBpbWFnZS5zcmMgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGZpbGUpXHJcbn0pXHJcblxyXG5mdW5jdGlvbiBvbkltYWdlTG9hZCAoKSB7XHJcbiAgICB2YXIgY2FudmFzID0gJCgnI2ltYWdlLWNhbnZhcycpWzBdXHJcbiAgICAgICwgJGNhbnZhcyA9ICQoJ2NhbnZhcycpXHJcbiAgICAgICwgY2FudmFzV2lkdGggPSAkY2FudmFzLndpZHRoKClcclxuICAgICAgLCBjYW52YXNIZWlnaHQgPSAkY2FudmFzLmhlaWdodCgpXHJcblxyXG4gICAgZHlJbWFnZSA9IG5ldyBEeUltYWdlKClcclxuICAgIGR5SW1hZ2UuaW1hZ2UgPSB0aGlzXHJcbiAgICBkeUltYWdlLmNhbnZhcyA9IGNhbnZhc1xyXG4gICAgZHlJbWFnZS5jaGFuZ2VTaXplKHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCBjYW52YXNXaWR0aClcclxuICAgIGR5SW1hZ2UueSA9IE1hdGguZmxvb3IoKGNhbnZhc0hlaWdodCAvIDIpIC0gKGR5SW1hZ2UuaGVpZ2h0IC8gMikpXHJcbiAgICBkeUltYWdlLnggPSBNYXRoLmZsb29yKChjYW52YXNXaWR0aCAvMiApIC0gKGR5SW1hZ2Uud2lkdGggLyAyKSlcclxuICAgIGR5SW1hZ2UuZHJhdygpXHJcblxyXG4gICAgJCgnI29wYWNpdHktbGFiZWwnKS50ZXh0KCdPcGFjaXR5OiAxMDAlJylcclxuXHJcbiAgICAvLyBhbGwgaW1hZ2Ugc2V0dGluZ3MgaW5pdGlhbGlzYXRpb24gXHJcbiAgICAkKCcuc2V0dGluZycpLmVhY2goZnVuY3Rpb24gKF8sIGVsZW1lbnQpIHtcclxuICAgICAgICBlbGVtZW50LmRpc2FibGVkID0gZmFsc2VcclxuICAgIH0pXHJcbiAgICAvLyBNYW5pcHVsYXRpbmcgdGhlIGltYWdlJ3Mgc2l6ZVxyXG4gICAgLmZpbHRlcignI3NpemUnKS5lYWNoKGZ1bmN0aW9uIChfLCBzaXplKSB7XHJcbiAgICAgICAgdmFyIHdpZHRoICA9IHRoaXMud2lkdGhcclxuICAgICAgICAgICwgZFdpZHRoID0gZHlJbWFnZS53aWR0aFxyXG4gICAgICAgIHNpemUubWluID0gd2lkdGggKiAwLjFcclxuICAgICAgICBpZiAoZFdpZHRoID4gd2lkdGgpIHtcclxuICAgICAgICAgICAgc2l6ZS5tYXggPSBkV2lkdGhcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzaXplLm1heCA9IHRoaXMuaGVpZ2h0XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNpemUudmFsdWUgPSBkV2lkdGhcclxuICAgICAgICBjaGFuZ2VQZXJjZW50YWdlKCcjc2l6ZS1sYWJlbCcsICdzaXplOiAnLCAodGhpcy53aWR0aCAvIGRXaWR0aCkpXHJcblxyXG4gICAgfS5iaW5kKHRoaXMpKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0LnZhbHVlXHJcbiAgICAgICAgICAsIG9sZFdpZHRoID0gZHlJbWFnZS53aWR0aFxyXG4gICAgICAgICAgLCBvbGRIZWlnaHQgPSBkeUltYWdlLmhlaWdodFxyXG5cclxuICAgICAgICBkeUltYWdlLmNoYW5nZVNpemUodGhpcy53aWR0aCwgdGhpcy5oZWlnaHQsIHRhcmdldClcclxuICAgICAgICBkeUltYWdlLnggLT0gZGlmZihkeUltYWdlLndpZHRoLCBvbGRXaWR0aCkgICAvIDJcclxuICAgICAgICBkeUltYWdlLnkgLT0gZGlmZihkeUltYWdlLmhlaWdodCwgb2xkSGVpZ2h0KSAvIDJcclxuICAgICAgICBkeUltYWdlLmRyYXcoKVxyXG5cclxuICAgICAgICBjaGFuZ2VQZXJjZW50YWdlKCcjc2l6ZS1sYWJlbCcsICdzaXplOiAnLCAodGFyZ2V0IC8gdGhpcy53aWR0aCkpXHJcbiAgICB9LmJpbmQodGhpcykpXHJcbiAgICAvLyBNYW5pcHVsYXRpbmcgdGhlIGltYWdlJ3NcclxuICAgIC5lbmQoKS5maWx0ZXIoJyNvcGFjaXR5Jykub24oJ2lucHV0JywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgdmFyIG5ld09wYWNpdHkgPSBldmVudC50YXJnZXQudmFsdWVcclxuICAgICAgICAkKCcjb3BhY2l0eS1sYWJlbCcpLnRleHQoJ09wYWNpdHk6ICcgKyBNYXRoLmZsb29yKG5ld09wYWNpdHkgKiAxMDApICsgJyUnKVxyXG4gICAgICAgIGR5SW1hZ2UuY2FudmFzLmdldENvbnRleHQoJzJkJykuZ2xvYmFsQWxwaGEgPSBuZXdPcGFjaXR5XHJcbiAgICAgICAgZHlJbWFnZS5kcmF3KClcclxuICAgIH0pXHJcbiAgICAvLyBNYW5pcHVsYXRpbmcgdGhlIGltYWdlJ3MgZmlsdGVyXHJcbiAgICAuZW5kKCkuZmlsdGVyKCcjZmlsdGVyJykuY2hhbmdlKGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHZhciAkY2FudmFzID0gJCgnI2ZpbHRlci1jYW52YXMnKVxyXG4gICAgICAgICAgLCBjb250ZXh0ID0gJGNhbnZhc1swXS5nZXRDb250ZXh0KCcyZCcpXHJcblxyXG4gICAgICAgIGNvbnRleHQuZmlsbFN0eWxlID0gZXZlbnQudGFyZ2V0LnZhbHVlXHJcbiAgICAgICAgY29udGV4dC5maWxsUmVjdCgwLCAwLCBjYW52YXNXaWR0aCwgY2FudmFzSGVpZ2h0KVxyXG4gICAgfSlcclxuICAgIC8vIE1hbmlwdWxhdGluZyB0aGUgZmlsdGVyIGNsZWFyIGJ1dHRvblxyXG4gICAgLmVuZCgpLmZpbHRlcignI2NsZWFyJykuY2xpY2soZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGNvbnRleHQgPSAkKCcjZmlsdGVyLWNhbnZhcycpWzBdLmdldENvbnRleHQoJzJkJylcclxuICAgICAgICBjb250ZXh0LmNsZWFyUmVjdCgwLCAwLCBjYW52YXNXaWR0aCwgY2FudmFzSGVpZ2h0KVxyXG4gICAgfSlcclxuICAgIC8vIE1hbmlwdWxhdGluZyB0aGUgaW1hZ2UncyBmaWx0ZXIncyBvcGFjaXR5XHJcbiAgICAuZW5kKCkuZmlsdGVyKCcjZmlsdGVyLW9wYWNpdHknKS5lYWNoKGZ1bmN0aW9uIChfLCBmaWx0ZXIpIHtcclxuICAgICAgICB2YXIgYWxwaGEgPSBmaWx0ZXIudmFsdWVcclxuICAgICAgICAkKCcjZmlsdGVyLWNhbnZhcycpWzBdLmdldENvbnRleHQoJzJkJykuZ2xvYmFsQWxwaGEgPSBhbHBoYVxyXG4gICAgICAgIGNoYW5nZVBlcmNlbnRhZ2UoJyNmaWx0ZXItb3BhY2l0eS1sYWJlbCcsICdDb2xvdXIgT3BhY2l0eTogJywgYWxwaGEpXHJcblxyXG4gICAgfSkub24oJ2lucHV0JywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgdmFyICRjYW52YXMgPSAkKCcjZmlsdGVyLWNhbnZhcycpXHJcbiAgICAgICAgICAsIGNvbnRleHQgPSAkY2FudmFzWzBdLmdldENvbnRleHQoJzJkJylcclxuICAgICAgICAgICwgYWxwaGEgPSBldmVudC50YXJnZXQudmFsdWVcclxuICAgICAgICBjb250ZXh0Lmdsb2JhbEFscGhhID0gYWxwaGFcclxuICAgICAgICBjb250ZXh0LmNsZWFyUmVjdCgwLCAwLCBjYW52YXNXaWR0aCwgY2FudmFzSGVpZ2h0KVxyXG4gICAgICAgIGNvbnRleHQuZmlsbFJlY3QoMCwgMCwgY2FudmFzV2lkdGgsIGNhbnZhc0hlaWdodClcclxuICAgICAgICBjaGFuZ2VQZXJjZW50YWdlKCcjZmlsdGVyLW9wYWNpdHktbGFiZWwnLCAnQ29sb3VyIE9wYWNpdHk6ICcsIGFscGhhKVxyXG4gICAgfSlcclxuICAgIC5lbmQoKS5maWx0ZXIoJyN1cGxvYWQnKS5jbGljayhmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgY2FudmFzZXMgPSAkKCcuY2FudmFzJylcclxuICAgICAgICAgICwgaGlkZGVuQ2FudmFzID0gJCgnI2hpZGRlbi1jYW52YXMnKVxyXG4gICAgICAgICAgLCBoaWRkZW5Db250ZXh0ID0gaGlkZGVuQ2FudmFzLmdldENvbnRleHQoJzJkJylcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNhbnZhc2VzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGhpZGRlbkNvbnRleHQuZHJhd0ltYWdlKGNhbnZhc2VzW2ldLCAwLCAwKVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zb2xlLmxvZyhoaWRkZW5DYW52YXMudG9EYXRhVVJMKCkpXHJcbiAgICB9KVxyXG59XHJcblxyXG5mdW5jdGlvbiBkaWZmIChhLCBiKSB7XHJcbiAgICBpZiAoYSA+IGIpIHtcclxuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihhIC0gYilcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoLShiIC0gYSkpXHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNoYW5nZVBlcmNlbnRhZ2UgKGVsZW1lbnQsIHRleHQsIHZhbHVlKSB7XHJcbiAgICB2YXIgcGVyY2VudGFnZSA9IE1hdGguZmxvb3IodmFsdWUgKiAxMDApXHJcbiAgICAkKGVsZW1lbnQpLnRleHQodGV4dCArIHBlcmNlbnRhZ2UgKyAnJScpXHJcbn0iLG51bGwsIlxyXG4vLyBAVE9ETyBkb2N1bWVudGF0aW9uXHJcbnZhciBzdWJtaXQgPSBmdW5jdGlvbihmb3JtVHlwZSkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHZhciBkYXRhXHJcbiAgICAgICAgICAsIHVzZXJuYW1lID0gJCgnLnVzZXJuYW1lJykudmFsKClcclxuICAgICAgICAgICwgcGFzc3dvcmQgPSAkKCcucGFzc3dvcmQnKS52YWwoKVxyXG5cclxuICAgICAgICBpZiAoZm9ybVR5cGUgPT0gJ2xvZ2luJykge1xyXG5cclxuICAgICAgICAgICAgZGF0YSA9IHsgdXNlcm5hbWU6IHVzZXJuYW1lXHJcbiAgICAgICAgICAgICAgICAgICAsIHBhc3N3b3JkOiBwYXNzd29yZFxyXG4gICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9IGVsc2UgaWYoZm9ybVR5cGUgPT0gJ3JlZ2lzdGVyJykge1xyXG5cclxuICAgICAgICAgICAgdmFyIGNvbmZpcm0gPSAkKCcuY29uZmlybScpLnZhbCgpXHJcblxyXG4gICAgICAgICAgICBpZiAoY29uZmltICE9IHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgICAgICAkKCcjZXJyb3InKS52YWwoJ3Bhc3N3b3JkcyBkb25cXCd0IG1hdGNoLicpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZGF0YSA9IHsgdXNlcm5hbWUgOiB1c2VybmFtZVxyXG4gICAgICAgICAgICAgICAgICAgLCBwYXNzd29yZCA6IHBhc3N3b3JkXHJcbiAgICAgICAgICAgICAgICAgICAsIGNvbmZpcm0gOiBjb25maXJtXHJcbiAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgdXJsOiAnL3VzZXJzLycrZm9ybVR5cGUsXHJcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICBkYXRhOiBkYXRhLFxyXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoYXJndW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIC8vIGJvZHkuLi5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLy8gSXMgdGhlIHNhbWUgaW4galF1ZXJ5IGFzIGhhdmluZyBib3RoIGV2ZW50LnByZXZlbnREZWZhdWx0KCkgYW5kIGV2ZW50LnN0b3BQcm9wZ2F0aW9uKClcclxuICAgICAgICByZXR1cm4gZmFsc2VcclxuICAgIH1cclxufVxyXG5cclxuJCgnI2xvZ2luJykuc3VibWl0KHN1Ym1pdCgnbG9naW4nKSlcclxuXHJcbiQoJyNyZWdpc3RlcicpLnN1Ym1pdChzdWJtaXQoJ3JlZ2lzdGVyJykpIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
