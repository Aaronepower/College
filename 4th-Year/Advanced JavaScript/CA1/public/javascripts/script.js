!function(t,e,a){"use strict";function i(){var a=t("#image-canvas")[0],i=t("canvas"),s=i.width(),c=i.height();l=new o,l.image=this,l.canvas=a,l.changeSize(this.width,this.height,s),l.y=Math.floor(c/2-l.height/2),l.x=Math.floor(s/2-l.width/2),l.draw(),t("#opacity-label").text("Opacity: 100%"),t(".setting").each(function(t,e){e.disabled=!1}).filter("#size").each(function(t,e){var a=this.width,i=l.width;e.min=.1*a,i>a?e.max=i:e.max=this.height,e.value=i,r("#size-label","size: ",this.width/i)}.bind(this)).on("input",function(t){var e=t.target.value,a=l.width,i=l.height;l.changeSize(this.width,this.height,e),l.x-=n(l.width,a)/2,l.y-=n(l.height,i)/2,l.draw(),r("#size-label","size: ",e/this.width)}.bind(this)).end().filter("#opacity").on("input",function(e){var a=e.target.value;t("#opacity-label").text("Opacity: "+Math.floor(100*a)+"%"),l.canvas.getContext("2d").globalAlpha=a,l.draw()}).end().filter("#filter").change(function(e){var a=t("#filter-canvas"),i=a[0].getContext("2d");i.fillStyle=e.target.value,i.fillRect(0,0,s,c)}).end().filter("#clear").click(function(){var e=t("#filter-canvas")[0].getContext("2d");e.clearRect(0,0,s,c)}).end().filter("#filter-opacity").each(function(e,a){var i=a.value;t("#filter-canvas")[0].getContext("2d").globalAlpha=i,r("#filter-opacity-label","Colour Opacity: ",i)}).on("input",function(e){var a=t("#filter-canvas"),i=a[0].getContext("2d"),n=e.target.value;i.globalAlpha=n,i.clearRect(0,0,s,c),i.fillRect(0,0,s,c),r("#filter-opacity-label","Colour Opacity: ",n)}).end().filter("#upload").click(function(){for(var a=t(".canvas"),i=t("#hidden-canvas")[0],n=i.getContext("2d"),r=0;r<a.length;r++)n.drawImage(a[r],0,0);var o=i.toDataURL(),s=localStorage.getItem("user"),l=t("#tags").val().replace(/ /g,"").split(",").filter(Boolean);t.ajax({url:"/users/"+s,method:"POST",data:{image:o,tags:l},success:function(){e.location="/"}})})}function n(t,e){return t>e?Math.floor(t-e):Math.floor(-(e-t))}function r(e,a,i){var n=Math.floor(100*i);t(e).text(a+n+"%")}function o(t){this.image=t,this.canvas=null,this.x=0,this.y=0,this.prevX=0,this.prevY=0,this.width=0,this.height=0}function s(e,a){var i=localStorage.getItem("user");i?t.ajax({url:"/users/validate",method:"POST",data:{id:i},error:e,success:a}):e()}var l=new o,c=!1;t("canvas").each(function(e,a){var i=t(a);t(".canvas-container").height(i.parent().width()),a.width=i.parent().width(),a.height=i.parent().width()}).filter("#image-canvas").mousedown(function(){c=!0}).mouseup(function(){c=!1}).mousemove(function(t){l.image&&c&&(l.x+=n(t.clientX,l.prevX),l.y+=n(t.clientY,l.prevY),l.draw()),l.prevX=t.clientX,l.prevY=t.clientY}),t("#file").change(function(t){var e=t.target.files[0],a=new Image;a.onload=i,a.src=URL.createObjectURL(e)}),o.prototype.changeSize=function(t,e,a){if(a>t&&a>e)return this.width=this.image.width,void(this.height=this.image.height);var i=e/t,n=Math.ceil(i*a);if(a>n){var r=t/e,o=Math.ceil(r*a);this.width=o,this.height=a}else this.width=a,this.height=n},o.prototype.setPos=function(t,e){this.x=t,this.y=e},o.prototype.draw=function(e,a,i,n){e=e||this.x,a=a||this.y,i=i||this.width,n=n||this.height;var r=t(this.canvas),o=this.canvas.getContext("2d");o.clearRect(0,0,r.width(),r.height()),o.drawImage(this.image,e,a,i,n)},t("#register").click(function(a){a.preventDefault(),a.stopPropagation();var i,n=t(".username").val(),r=t(".password").val(),o=t(".confirm").val();o!=r&&t("#error").val("passwords don't match."),i={username:n,password:r,confirm:o},t.ajax({url:"/users/register",method:"POST",data:i,success:function(t){localStorage.setItem("user",t),e.location="/"},error:function(){console.log(arguments),t("#error").val("Error registering")}})}),t("#login").click(function(a){a.preventDefault(),a.stopPropagation();var i,n=t(".username").val(),r=t(".password").val();i={username:n,password:r},t.ajax({url:"/users/login",method:"POST",data:i,success:function(t){localStorage.setItem("user",t),e.location="/"},error:function(){t("#error").val("No user with that username, or password exists.")}})}),t(".image").click(function(e){var a=t(e.target),i=a.data("tags").replace(/ /g,"").split(",").filter(Boolean);t("#tag-listing").empty(),i.forEach(function(e){t("#tag-listing").append('<a class="twelve columns" href="/tags/'+e+'"><h4>'+e+"</h4></a>")})}),s(function(){t("#upload-button").remove()},function(){t("#user-buttons").remove()})}($,window,document);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbnZhcy5qcyIsImR5bmFtaWNJbWFnZS5qcyIsImZvcm0uanMiLCJpbmRleC5qcyIsInNjcmlwdC5qcyJdLCJuYW1lcyI6WyIkIiwid2luZG93IiwiZG9jdW1lbnQiLCJvbkltYWdlTG9hZCIsImNhbnZhcyIsIiRjYW52YXMiLCJjYW52YXNXaWR0aCIsIndpZHRoIiwiY2FudmFzSGVpZ2h0IiwiaGVpZ2h0IiwiZHlJbWFnZSIsIkR5SW1hZ2UiLCJpbWFnZSIsInRoaXMiLCJjaGFuZ2VTaXplIiwieSIsIk1hdGgiLCJmbG9vciIsIngiLCJkcmF3IiwidGV4dCIsImVhY2giLCJfIiwiZWxlbWVudCIsImRpc2FibGVkIiwiZmlsdGVyIiwic2l6ZSIsImRXaWR0aCIsIm1pbiIsIm1heCIsInZhbHVlIiwiY2hhbmdlUGVyY2VudGFnZSIsImJpbmQiLCJvbiIsImV2ZW50IiwidGFyZ2V0Iiwib2xkV2lkdGgiLCJvbGRIZWlnaHQiLCJkaWZmIiwiZW5kIiwibmV3T3BhY2l0eSIsImdldENvbnRleHQiLCJnbG9iYWxBbHBoYSIsImNoYW5nZSIsImNvbnRleHQiLCJmaWxsU3R5bGUiLCJmaWxsUmVjdCIsImNsaWNrIiwiY2xlYXJSZWN0IiwiYWxwaGEiLCJjYW52YXNlcyIsImhpZGRlbkNhbnZhcyIsImhpZGRlbkNvbnRleHQiLCJpIiwibGVuZ3RoIiwiZHJhd0ltYWdlIiwidG9EYXRhVVJMIiwidXNlciIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJ0YWdzIiwidmFsIiwicmVwbGFjZSIsInNwbGl0IiwiQm9vbGVhbiIsImFqYXgiLCJ1cmwiLCJtZXRob2QiLCJkYXRhIiwic3VjY2VzcyIsImxvY2F0aW9uIiwiYSIsImIiLCJwZXJjZW50YWdlIiwicHJldlgiLCJwcmV2WSIsInZhbGlkVXNlciIsImVycm9yIiwidXNlcklkIiwiaWQiLCJpc01vdXNlZG93biIsInBhcmVudCIsIm1vdXNlZG93biIsIm1vdXNldXAiLCJtb3VzZW1vdmUiLCJjbGllbnRYIiwiY2xpZW50WSIsImZpbGUiLCJmaWxlcyIsIkltYWdlIiwib25sb2FkIiwic3JjIiwiVVJMIiwiY3JlYXRlT2JqZWN0VVJMIiwicHJvdG90eXBlIiwiYXNwZWN0UmF0aW8iLCJuZXdIZWlnaHQiLCJjZWlsIiwibmV3QXNwZWN0UmF0aW8iLCJuZXdXaWR0aCIsInNldFBvcyIsInByZXZlbnREZWZhdWx0Iiwic3RvcFByb3BhZ2F0aW9uIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsImNvbmZpcm0iLCJzZXRJdGVtIiwiY29uc29sZSIsImxvZyIsImFyZ3VtZW50cyIsIiRpbWFnZSIsImVtcHR5IiwiZm9yRWFjaCIsInRhZyIsImFwcGVuZCIsInJlbW92ZSJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsRUFBQUMsR0FDQSxZQXNDQSxTQUFBQyxLQUNBLEdBQUFDLEdBQUFKLEVBQUEsaUJBQUEsR0FDQUssRUFBQUwsRUFBQSxVQUNBTSxFQUFBRCxFQUFBRSxRQUNBQyxFQUFBSCxFQUFBSSxRQUVBQyxHQUFBLEdBQUFDLEdBRUFELEVBQUFFLE1BQUFDLEtBQ0FILEVBQUFOLE9BQUFBLEVBQ0FNLEVBQUFJLFdBQUFELEtBQUFOLE1BQUFNLEtBQUFKLE9BQUFILEdBQ0FJLEVBQUFLLEVBQUFDLEtBQUFDLE1BQUFULEVBQUEsRUFBQUUsRUFBQUQsT0FBQSxHQUNBQyxFQUFBUSxFQUFBRixLQUFBQyxNQUFBWCxFQUFBLEVBQUFJLEVBQUFILE1BQUEsR0FDQUcsRUFBQVMsT0FFQW5CLEVBQUEsa0JBQUFvQixLQUFBLGlCQUdBcEIsRUFBQSxZQUFBcUIsS0FBQSxTQUFBQyxFQUFBQyxHQUNBQSxFQUFBQyxVQUFBLElBS0FDLE9BQUEsU0FBQUosS0FBQSxTQUFBQyxFQUFBSSxHQUNBLEdBQUFuQixHQUFBTSxLQUFBTixNQUNBb0IsRUFBQWpCLEVBQUFILEtBQ0FtQixHQUFBRSxJQUFBLEdBQUFyQixFQUNBb0IsRUFBQXBCLEVBQ0FtQixFQUFBRyxJQUFBRixFQUVBRCxFQUFBRyxJQUFBaEIsS0FBQUosT0FFQWlCLEVB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RyxFQUFBaUUsTUFDQUMsSUFBQSxrQkFDQUMsT0FBQSxPQUNBQyxLQUFBQSxFQUNBQyxRQUFBLFNBQUFELEdBQ0FWLGFBQUFnRCxRQUFBLE9BQUF0QyxHQUNBbkUsRUFBQXFFLFNBQUEsS0FFQU8sTUFBQSxXQUNBOEIsUUFBQUMsSUFBQUMsV0FDQTdHLEVBQUEsVUFBQTZELElBQUEsMEJBS0E3RCxFQUFBLFVBQUErQyxNQUFBLFNBQUFiLEdBQ0FBLEVBQUFtRSxpQkFDQW5FLEVBQUFvRSxpQkFDQSxJQUFBbEMsR0FDQW1DLEVBQUF2RyxFQUFBLGFBQUE2RCxNQUNBMkMsRUFBQXhHLEVBQUEsYUFBQTZELEtBRUFPLElBQUFtQyxTQUFBQSxFQUNBQyxTQUFBQSxHQUdBeEcsRUFBQWlFLE1BQ0FDLElBQUEsZUFDQUMsT0FBQSxPQUNBQyxLQUFBQSxFQUNBQyxRQUFBLFNBQUFELEdBQ0FWLGFBQUFnRCxRQUFBLE9BQUF0QyxHQUNBbkUsRUFBQXFFLFNBQUEsS0FFQU8sTUFBQSxXQUNBN0UsRUFBQSxVQUFBNkQsSUFBQSx3RENyREE3RCxFQUFBLFVBQUErQyxNQUFBLFNBQUFiLEdBQ0EsR0FBQTRFLEdBQUE5RyxFQUFBa0MsRUFBQUMsUUFDQXlCLEVBQUFrRCxFQUFBMUMsS0FBQSxRQUFBTixRQUFBLEtBQUEsSUFBQUMsTUFBQSxLQUFBdEMsT0FBQXVDLFFBQ0FoRSxHQUFBLGdCQUFBK0csUUFDQW5ELEVBQUFvRCxRQUFBLFNBQUFDLEdBQ0FqSCxFQUFBLGdCQUFBa0gsT0FBQSx5Q0FBQUQsRUFBQSxTQUFBQSxFQUFBLGlCQUlBckMsRUFBQSxXQUNBNUUsRUFBQSxrQkFBQW1ILFVBRUEsV0MrUkluSCxFQUFFLGlCQUFpQm1ILFlBRXBCbkgsRUFBR0MsT0FBUUMiLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGR5SW1hZ2UgPSBuZXcgRHlJbWFnZSgpXHJcbiAgLCBpc01vdXNlZG93biA9IGZhbHNlXHJcblxyXG4kKCdjYW52YXMnKVxyXG4vLyBEeW5hbWljYWxseSBzZXQgdGhlIHdpZHRoLCBhbmQgaGVpZ2h0IG9mIGFsbCBjYW52YXMnLiBIYXMgdG8gYmUgZG9uZSB1c2luZ1xyXG4vLyBKYXZhU2NyaXB0IGFzIG9wcG9zZWQgdG8gQ1NTLCBhcyBDU1MganVzdCBtYWduaWZpZXMsIGFuZCBzdHJldGNoZXMgdGhlIGNhbnZhcy5cclxuLmVhY2goZnVuY3Rpb24gKGksIGNhbnZhcykge1xyXG4gICAgdmFyICRjYW52YXMgPSAkKGNhbnZhcylcclxuICAgICQoJy5jYW52YXMtY29udGFpbmVyJykuaGVpZ2h0KCRjYW52YXMucGFyZW50KCkud2lkdGgoKSlcclxuXHJcbiAgICBjYW52YXMud2lkdGggPSAkY2FudmFzLnBhcmVudCgpLndpZHRoKClcclxuICAgIGNhbnZhcy5oZWlnaHQgPSAkY2FudmFzLnBhcmVudCgpLndpZHRoKClcclxufSlcclxuLmZpbHRlcignI2ltYWdlLWNhbnZhcycpXHJcbi8vIEVuYWJsZXMgYSBjbGljay1hbmQtZHJhZyBzdHlsZSBvbiB0aGUgY2FudmFzIGZvciBtb3ZpbmcgdGhlIGltYWdlXHJcbi5tb3VzZWRvd24oZnVuY3Rpb24oKSB7aXNNb3VzZWRvd24gPSB0cnVlfSlcclxuLm1vdXNldXAoZnVuY3Rpb24oKSB7aXNNb3VzZWRvd24gPSBmYWxzZX0pXHJcbi5tb3VzZW1vdmUoZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICBpZiAoZHlJbWFnZS5pbWFnZSAmJiBpc01vdXNlZG93bikge1xyXG4gICAgICAgIGR5SW1hZ2UueCArPSBkaWZmKGV2ZW50LmNsaWVudFgsIGR5SW1hZ2UucHJldlgpXHJcbiAgICAgICAgZHlJbWFnZS55ICs9IGRpZmYoZXZlbnQuY2xpZW50WSwgZHlJbWFnZS5wcmV2WSlcclxuICAgICAgICBkeUltYWdlLmRyYXcoKVxyXG4gICAgfVxyXG5cclxuICAgIGR5SW1hZ2UucHJldlggPSBldmVudC5jbGllbnRYXHJcbiAgICBkeUltYWdlLnByZXZZID0gZXZlbnQuY2xpZW50WVxyXG59KVxyXG5cclxuLy8gT25jZSBhbiBpbWFnZSBoYXMgYmVlbiBhY2NlcHRlZCwgd2UgY3JlYXRlIGFuIGltYWdlIG9iamVjdCwgYW5kIG9uY2UgdGhlIFxyXG4vLyBpbWFnZSBoYXMgbG9hZGVkIHJ1biBvbkltYWdlTG9hZCBmdW5jdGlvblxyXG4kKCcjZmlsZScpLmNoYW5nZShmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgIHZhciBmaWxlID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdXHJcbiAgICB2YXIgaW1hZ2UgPSBuZXcgSW1hZ2UoKVxyXG4gICAgaW1hZ2Uub25sb2FkID0gb25JbWFnZUxvYWRcclxuICAgIGltYWdlLnNyYyA9IFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSlcclxufSlcclxuXHJcbmZ1bmN0aW9uIG9uSW1hZ2VMb2FkICgpIHtcclxuICAgIHZhciBjYW52YXMgICAgICAgPSAkKCcjaW1hZ2UtY2FudmFzJylbMF1cclxuICAgICAgLCAkY2FudmFzICAgICAgPSAkKCdjYW52YXMnKVxyXG4gICAgICAsIGNhbnZhc1dpZHRoICA9ICRjYW52YXMud2lkdGgoKVxyXG4gICAgICAsIGNhbnZhc0hlaWdodCA9ICRjYW52YXMuaGVpZ2h0KClcclxuXHJcbiAgICBkeUltYWdlID0gbmV3IER5SW1hZ2UoKVxyXG5cclxuICAgIGR5SW1hZ2UuaW1hZ2UgPSB0aGlzXHJcbiAgICBkeUltYWdlLmNhbnZhcyA9IGNhbnZhc1xyXG4gICAgZHlJbWFnZS5jaGFuZ2VTaXplKHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCBjYW52YXNXaWR0aClcclxuICAgIGR5SW1hZ2UueSA9IE1hdGguZmxvb3IoKGNhbnZhc0hlaWdodCAvIDIpIC0gKGR5SW1hZ2UuaGVpZ2h0IC8gMikpXHJcbiAgICBkeUltYWdlLnggPSBNYXRoLmZsb29yKChjYW52YXNXaWR0aCAgLyAyKSAtIChkeUltYWdlLndpZHRoICAvIDIpKVxyXG4gICAgZHlJbWFnZS5kcmF3KClcclxuXHJcbiAgICAkKCcjb3BhY2l0eS1sYWJlbCcpLnRleHQoJ09wYWNpdHk6IDEwMCUnKVxyXG5cclxuICAgIC8vIGFsbCBpbWFnZSBzZXR0aW5ncyBpbml0aWFsaXNhdGlvbiBcclxuICAgICQoJy5zZXR0aW5nJykuZWFjaChmdW5jdGlvbiAoXywgZWxlbWVudCkge1xyXG4gICAgICAgIGVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZVxyXG4gICAgfSlcclxuICAgIC8vIE1hbmlwdWxhdGluZyB0aGUgaW1hZ2UncyBzaXplXHJcbiAgICAvLyBldmVudCBmdW5jdGlvbnMgdGhpcyB2YWx1ZSBhcmUgY2hhbmdlIHRvIHRoZSBpbWFnZSwgdG8gYWNjZXNzIHRoZSBpbWFnZSdzXHJcbiAgICAvLyB3aWR0aFxyXG4gICAgLmZpbHRlcignI3NpemUnKS5lYWNoKGZ1bmN0aW9uIChfLCBzaXplKSB7XHJcbiAgICAgICAgdmFyIHdpZHRoICA9IHRoaXMud2lkdGhcclxuICAgICAgICAgICwgZFdpZHRoID0gZHlJbWFnZS53aWR0aFxyXG4gICAgICAgIHNpemUubWluID0gd2lkdGggKiAwLjFcclxuICAgICAgICBpZiAoZFdpZHRoID4gd2lkdGgpIHtcclxuICAgICAgICAgICAgc2l6ZS5tYXggPSBkV2lkdGhcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzaXplLm1heCA9IHRoaXMuaGVpZ2h0XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNpemUudmFsdWUgPSBkV2lkdGhcclxuICAgICAgICBjaGFuZ2VQZXJjZW50YWdlKCcjc2l6ZS1sYWJlbCcsICdzaXplOiAnLCAodGhpcy53aWR0aCAvIGRXaWR0aCkpXHJcblxyXG4gICAgfS5iaW5kKHRoaXMpKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0LnZhbHVlXHJcbiAgICAgICAgICAsIG9sZFdpZHRoID0gZHlJbWFnZS53aWR0aFxyXG4gICAgICAgICAgLCBvbGRIZWlnaHQgPSBkeUltYWdlLmhlaWdodFxyXG5cclxuICAgICAgICBkeUltYWdlLmNoYW5nZVNpemUodGhpcy53aWR0aCwgdGhpcy5oZWlnaHQsIHRhcmdldClcclxuICAgICAgICBkeUltYWdlLnggLT0gZGlmZihkeUltYWdlLndpZHRoLCBvbGRXaWR0aCkgICAvIDJcclxuICAgICAgICBkeUltYWdlLnkgLT0gZGlmZihkeUltYWdlLmhlaWdodCwgb2xkSGVpZ2h0KSAvIDJcclxuICAgICAgICBkeUltYWdlLmRyYXcoKVxyXG5cclxuICAgICAgICBjaGFuZ2VQZXJjZW50YWdlKCcjc2l6ZS1sYWJlbCcsICdzaXplOiAnLCAodGFyZ2V0IC8gdGhpcy53aWR0aCkpXHJcbiAgICB9LmJpbmQodGhpcykpXHJcbiAgICAvLyBNYW5pcHVsYXRpbmcgdGhlIGltYWdlJ3Mgb3BhY2l0eVxyXG4gICAgLmVuZCgpLmZpbHRlcignI29wYWNpdHknKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICB2YXIgbmV3T3BhY2l0eSA9IGV2ZW50LnRhcmdldC52YWx1ZVxyXG4gICAgICAgICQoJyNvcGFjaXR5LWxhYmVsJykudGV4dCgnT3BhY2l0eTogJyArIE1hdGguZmxvb3IobmV3T3BhY2l0eSAqIDEwMCkgKyAnJScpXHJcbiAgICAgICAgZHlJbWFnZS5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKS5nbG9iYWxBbHBoYSA9IG5ld09wYWNpdHlcclxuICAgICAgICBkeUltYWdlLmRyYXcoKVxyXG4gICAgfSlcclxuICAgIC8vIE1hbmlwdWxhdGluZyB0aGUgaW1hZ2UncyBmaWx0ZXJcclxuICAgIC5lbmQoKS5maWx0ZXIoJyNmaWx0ZXInKS5jaGFuZ2UoZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgdmFyICRjYW52YXMgPSAkKCcjZmlsdGVyLWNhbnZhcycpXHJcbiAgICAgICAgICAsIGNvbnRleHQgPSAkY2FudmFzWzBdLmdldENvbnRleHQoJzJkJylcclxuXHJcbiAgICAgICAgY29udGV4dC5maWxsU3R5bGUgPSBldmVudC50YXJnZXQudmFsdWVcclxuICAgICAgICBjb250ZXh0LmZpbGxSZWN0KDAsIDAsIGNhbnZhc1dpZHRoLCBjYW52YXNIZWlnaHQpXHJcbiAgICB9KVxyXG4gICAgLy8gTWFuaXB1bGF0aW5nIHRoZSBmaWx0ZXIgY2xlYXIgYnV0dG9uXHJcbiAgICAuZW5kKCkuZmlsdGVyKCcjY2xlYXInKS5jbGljayhmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgY29udGV4dCA9ICQoJyNmaWx0ZXItY2FudmFzJylbMF0uZ2V0Q29udGV4dCgnMmQnKVxyXG4gICAgICAgIGNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc1dpZHRoLCBjYW52YXNIZWlnaHQpXHJcbiAgICB9KVxyXG4gICAgLy8gTWFuaXB1bGF0aW5nIHRoZSBpbWFnZSdzIGZpbHRlcidzIG9wYWNpdHlcclxuICAgIC5lbmQoKS5maWx0ZXIoJyNmaWx0ZXItb3BhY2l0eScpLmVhY2goZnVuY3Rpb24gKF8sIGZpbHRlcikge1xyXG4gICAgICAgIHZhciBhbHBoYSA9IGZpbHRlci52YWx1ZVxyXG4gICAgICAgICQoJyNmaWx0ZXItY2FudmFzJylbMF0uZ2V0Q29udGV4dCgnMmQnKS5nbG9iYWxBbHBoYSA9IGFscGhhXHJcbiAgICAgICAgY2hhbmdlUGVyY2VudGFnZSgnI2ZpbHRlci1vcGFjaXR5LWxhYmVsJywgJ0NvbG91ciBPcGFjaXR5OiAnLCBhbHBoYSlcclxuXHJcbiAgICB9KS5vbignaW5wdXQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICB2YXIgJGNhbnZhcyA9ICQoJyNmaWx0ZXItY2FudmFzJylcclxuICAgICAgICAgICwgY29udGV4dCA9ICRjYW52YXNbMF0uZ2V0Q29udGV4dCgnMmQnKVxyXG4gICAgICAgICAgLCBhbHBoYSA9IGV2ZW50LnRhcmdldC52YWx1ZVxyXG4gICAgICAgIGNvbnRleHQuZ2xvYmFsQWxwaGEgPSBhbHBoYVxyXG4gICAgICAgIGNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc1dpZHRoLCBjYW52YXNIZWlnaHQpXHJcbiAgICAgICAgY29udGV4dC5maWxsUmVjdCgwLCAwLCBjYW52YXNXaWR0aCwgY2FudmFzSGVpZ2h0KVxyXG4gICAgICAgIGNoYW5nZVBlcmNlbnRhZ2UoJyNmaWx0ZXItb3BhY2l0eS1sYWJlbCcsICdDb2xvdXIgT3BhY2l0eTogJywgYWxwaGEpXHJcbiAgICB9KVxyXG4gICAgLy8gRHJhd3MgdGhlIHR3byBjYW52YXMnIG9udG8gYSBzZWNyZXQgY2FudmFzLCBhbmQgdGFrZXMgdGhlIGhpZGRlbiBjYW52YXNcclxuICAgIC8vIGFzIGEgc2luZ2xlIGltYWdlLCBhbmQgdXBsb2FkcyBpdCB0byB0aGUgc2VydmVyLiBcclxuICAgIC5lbmQoKS5maWx0ZXIoJyN1cGxvYWQnKS5jbGljayhmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgY2FudmFzZXMgPSAkKCcuY2FudmFzJylcclxuICAgICAgICAgICwgaGlkZGVuQ2FudmFzID0gJCgnI2hpZGRlbi1jYW52YXMnKVswXVxyXG4gICAgICAgICAgLCBoaWRkZW5Db250ZXh0ID0gaGlkZGVuQ2FudmFzLmdldENvbnRleHQoJzJkJylcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNhbnZhc2VzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGhpZGRlbkNvbnRleHQuZHJhd0ltYWdlKGNhbnZhc2VzW2ldLCAwLCAwKVxyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgaW1hZ2UgPSBoaWRkZW5DYW52YXMudG9EYXRhVVJMKClcclxuICAgICAgICB2YXIgdXNlciA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1c2VyJylcclxuICAgICAgICB2YXIgdGFncyA9ICQoJyN0YWdzJykudmFsKCkucmVwbGFjZSgvIC9nLCAnJykuc3BsaXQoJywnKS5maWx0ZXIoQm9vbGVhbilcclxuXHJcbiAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgdXJsOiAnL3VzZXJzLycrdXNlcixcclxuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgIGRhdGE6IHtpbWFnZTogaW1hZ2UsIHRhZ3M6IHRhZ3N9LFxyXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSAnLydcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9KVxyXG59XHJcblxyXG4vLyBSZXR1cm5zIHRoZSBjb3JyZWN0IGNvb3JkaW5hdGUgZGlmZmVyZW5jZSBmb3IgbW92aW5nIGFuIGltYWdlIHdpdGggYSBtb3VzZSxcclxuLy8gYW5kIHJlc2l6aW5nIHRoZSBpbWFnZSBmcm9tIGl0J3MgY2VudHJlLlxyXG5mdW5jdGlvbiBkaWZmIChhLCBiKSB7XHJcbiAgICBpZiAoYSA+IGIpIHtcclxuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihhIC0gYilcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoLShiIC0gYSkpXHJcbiAgICB9XHJcbn1cclxuLy8gQ2hhbmdlIHRoZSBwZXJjZW50YWdlIHRleHQgb2YgYW4gZWxlbWVudFxyXG5mdW5jdGlvbiBjaGFuZ2VQZXJjZW50YWdlIChlbGVtZW50LCB0ZXh0LCB2YWx1ZSkge1xyXG4gICAgdmFyIHBlcmNlbnRhZ2UgPSBNYXRoLmZsb29yKHZhbHVlICogMTAwKVxyXG4gICAgJChlbGVtZW50KS50ZXh0KHRleHQgKyBwZXJjZW50YWdlICsgJyUnKVxyXG59IiwiLy8gSW1hZ2UgY2xhc3MgZm9yIGhhbmRsaW5nIG1vdmluZywgYW5kIGNoYW5naW5nIHRoZSBpbWFnZSdzIHNpemUgZHluYW1pY2FsbHlcclxuLy8gd2l0aGluIHRoZSBjYW52YXMuXHJcbmZ1bmN0aW9uIER5SW1hZ2UgKGltYWdlKSB7XHJcblx0dGhpcy5pbWFnZSA9IGltYWdlXHJcblx0dGhpcy5jYW52YXMgPSBudWxsXHJcblx0dGhpcy54ID0gMFxyXG5cdHRoaXMueSA9IDBcclxuXHR0aGlzLnByZXZYID0gMFxyXG5cdHRoaXMucHJldlkgPSAwXHJcblx0dGhpcy53aWR0aCA9IDBcclxuXHR0aGlzLmhlaWdodCA9IDBcclxufVxyXG4vLyBTY2FsZXMgdGhlIGltYWdlIHNvIHRoYXQgaXQgbG9va3MgbmljZSB3aXRoaW4gdGhlIGNhbnZhcy5cclxuLy8gQnJpbmdzIHRoZSBoZWlnaHQgZG93biB0byB0aGUgaGVpZ2h0IG9mIHRoZSBjYW52YXMuXHJcbkR5SW1hZ2UucHJvdG90eXBlLmNoYW5nZVNpemUgPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCwgdGFyZ2V0KSB7XHJcblx0aWYgKHRhcmdldCA+IHdpZHRoICYmIHRhcmdldCA+IGhlaWdodCkge1xyXG5cdFx0dGhpcy53aWR0aCA9IHRoaXMuaW1hZ2Uud2lkdGhcclxuXHRcdHRoaXMuaGVpZ2h0ID0gdGhpcy5pbWFnZS5oZWlnaHRcclxuXHRcdHJldHVybjtcclxuXHR9XHJcblxyXG5cdHZhciBhc3BlY3RSYXRpbyA9IGhlaWdodCAvIHdpZHRoXHJcblx0ICAsIG5ld0hlaWdodCAgID0gTWF0aC5jZWlsKGFzcGVjdFJhdGlvICogdGFyZ2V0KVxyXG5cclxuXHRpZiAobmV3SGVpZ2h0IDwgdGFyZ2V0KSB7XHJcblx0XHR2YXIgbmV3QXNwZWN0UmF0aW8gPSB3aWR0aCAvIGhlaWdodFxyXG5cdFx0ICAsIG5ld1dpZHRoID0gTWF0aC5jZWlsKG5ld0FzcGVjdFJhdGlvICogdGFyZ2V0KVxyXG5cclxuXHRcdHRoaXMud2lkdGggPSBuZXdXaWR0aFxyXG5cdFx0dGhpcy5oZWlnaHQgPSB0YXJnZXRcclxuXHRcclxuXHR9IGVsc2Uge1xyXG5cdFx0dGhpcy53aWR0aCA9IHRhcmdldFxyXG5cdFx0dGhpcy5oZWlnaHQgPSBuZXdIZWlnaHRcclxuXHR9XHJcbn1cclxuXHJcbi8vIHNldCB0aGUgeCwgYW5kIHkgcG9zaXRpb24gb2YgdGhlIGltYWdlXHJcbkR5SW1hZ2UucHJvdG90eXBlLnNldFBvcyA9IGZ1bmN0aW9uKHgsIHkpIHtcclxuXHR0aGlzLnggPSB4XHJcblx0dGhpcy55ID0geVxyXG59XHJcblxyXG4vLyBEcmF3IHRoZSBpbWFnZSBvbiB0byB0aGUgY2FudmFzLCB3aXRoIGFuIG9wdGlvbiB0byBvdmVycmlkZSB0aGUgeCwgeSwgd2lkdGgsXHJcbi8vIGFuZCBoZWlnaHQgYXR0cmlidXRlc1xyXG5EeUltYWdlLnByb3RvdHlwZS5kcmF3ID0gZnVuY3Rpb24oeCwgeSwgd2lkdGgsIGhlaWdodCkge1xyXG5cdHggPSB4IHx8IHRoaXMueFxyXG5cdHkgPSB5IHx8IHRoaXMueVxyXG5cdHdpZHRoID0gd2lkdGggfHwgdGhpcy53aWR0aFxyXG5cdGhlaWdodCA9IGhlaWdodCB8fCB0aGlzLmhlaWdodFxyXG5cclxuXHR2YXIgJGNhbnZhcyA9ICQodGhpcy5jYW52YXMpXHJcblx0ICAsIGNvbnRleHQgPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpXHJcbiAgICBjb250ZXh0LmNsZWFyUmVjdCgwLCAwLCAkY2FudmFzLndpZHRoKCksICRjYW52YXMuaGVpZ2h0KCkpXHJcbiAgICBjb250ZXh0LmRyYXdJbWFnZSh0aGlzLmltYWdlLCB4LCB5LCB3aWR0aCwgaGVpZ2h0KVxyXG59OyIsIiQoJyNyZWdpc3RlcicpLmNsaWNrKGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxyXG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKClcclxuICAgIHZhciBkYXRhXHJcbiAgICAgICwgdXNlcm5hbWUgPSAkKCcudXNlcm5hbWUnKS52YWwoKVxyXG4gICAgICAsIHBhc3N3b3JkID0gJCgnLnBhc3N3b3JkJykudmFsKClcclxuICAgICAgLCBjb25maXJtICA9ICQoJy5jb25maXJtJykudmFsKClcclxuXHJcbiAgICBpZiAoY29uZmlybSAhPSBwYXNzd29yZCkge1xyXG4gICAgICAkKCcjZXJyb3InKS52YWwoJ3Bhc3N3b3JkcyBkb25cXCd0IG1hdGNoLicpXHJcbiAgICB9XHJcblxyXG4gICAgZGF0YSA9IHsgdXNlcm5hbWUgOiB1c2VybmFtZVxyXG4gICAgICAgICAgICwgcGFzc3dvcmQgOiBwYXNzd29yZFxyXG4gICAgICAgICAgICwgY29uZmlybSA6IGNvbmZpcm1cclxuICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICQuYWpheCh7XHJcbiAgICAgICAgdXJsOiAnL3VzZXJzL3JlZ2lzdGVyJyxcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICBkYXRhOiBkYXRhLFxyXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd1c2VyJywgZGF0YSlcclxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gJy8nXHJcbiAgICAgICAgfSwgXHJcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICAkKCcjZXJyb3InKS52YWwoJ0Vycm9yIHJlZ2lzdGVyaW5nJylcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG59KVxyXG5cclxuJCgnI2xvZ2luJykuY2xpY2soZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXHJcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKVxyXG4gICAgdmFyIGRhdGFcclxuICAgICAgLCB1c2VybmFtZSA9ICQoJy51c2VybmFtZScpLnZhbCgpXHJcbiAgICAgICwgcGFzc3dvcmQgPSAkKCcucGFzc3dvcmQnKS52YWwoKVxyXG5cclxuICAgICAgICBkYXRhID0geyB1c2VybmFtZTogdXNlcm5hbWVcclxuICAgICAgICAgICAgICAgLCBwYXNzd29yZDogcGFzc3dvcmRcclxuICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICQuYWpheCh7XHJcbiAgICAgICAgdXJsOiAnL3VzZXJzL2xvZ2luJyxcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICBkYXRhOiBkYXRhLFxyXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd1c2VyJywgZGF0YSlcclxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gJy8nXHJcbiAgICAgICAgfSwgXHJcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkKCcjZXJyb3InKS52YWwoJ05vIHVzZXIgd2l0aCB0aGF0IHVzZXJuYW1lLCBvciBwYXNzd29yZCBleGlzdHMuJylcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG59KVxyXG5cclxuZnVuY3Rpb24gdmFsaWRVc2VyKGVycm9yLCBzdWNjZXNzKSB7XHJcbiAgICB2YXIgdXNlcklkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXInKVxyXG4gICAgaWYgKCF1c2VySWQpIHtcclxuICAgICAgICBlcnJvcigpXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgIHVybDogJy91c2Vycy92YWxpZGF0ZScsXHJcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICBkYXRhOiB7aWQ6IHVzZXJJZH0sXHJcbiAgICAgICAgICAgIGVycm9yOiBlcnJvcixcclxuICAgICAgICAgICAgc3VjY2Vzczogc3VjY2Vzc1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcbn0iLCIkKCcuaW1hZ2UnKS5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgIHZhciAkaW1hZ2UgPSAkKGV2ZW50LnRhcmdldClcclxuICAgIHZhciB0YWdzID0gJGltYWdlLmRhdGEoJ3RhZ3MnKS5yZXBsYWNlKC8gL2csICcnKS5zcGxpdCgnLCcpLmZpbHRlcihCb29sZWFuKVxyXG4gICAgJCgnI3RhZy1saXN0aW5nJykuZW1wdHkoKVxyXG4gICAgdGFncy5mb3JFYWNoKGZ1bmN0aW9uICh0YWcpe1xyXG4gICAgICAgICQoJyN0YWctbGlzdGluZycpLmFwcGVuZCgnPGEgY2xhc3M9XCJ0d2VsdmUgY29sdW1uc1wiIGhyZWY9XCIvdGFncy8nK3RhZysnXCI+PGg0PicrdGFnKyc8L2g0PjwvYT4nKVxyXG4gICAgfSk7XHJcbn0pXHJcblxyXG52YWxpZFVzZXIoZnVuY3Rpb24oKSB7XHJcbiAgICAkKCcjdXBsb2FkLWJ1dHRvbicpLnJlbW92ZSgpXHJcbn0sXHJcbmZ1bmN0aW9uKCkge1xyXG4gICAgJCgnI3VzZXItYnV0dG9ucycpLnJlbW92ZSgpXHJcbn0pIiwiKGZ1bmN0aW9uICgkLCB3aW5kb3csIGRvY3VtZW50KXtcbiBcInVzZSBzdHJpY3RcIjtcbiB2YXIgZHlJbWFnZSA9IG5ldyBEeUltYWdlKClcclxuICAsIGlzTW91c2Vkb3duID0gZmFsc2VcclxuXHJcbiQoJ2NhbnZhcycpXHJcbi8vIER5bmFtaWNhbGx5IHNldCB0aGUgd2lkdGgsIGFuZCBoZWlnaHQgb2YgYWxsIGNhbnZhcycuIEhhcyB0byBiZSBkb25lIHVzaW5nXHJcbi8vIEphdmFTY3JpcHQgYXMgb3Bwb3NlZCB0byBDU1MsIGFzIENTUyBqdXN0IG1hZ25pZmllcywgYW5kIHN0cmV0Y2hlcyB0aGUgY2FudmFzLlxyXG4uZWFjaChmdW5jdGlvbiAoaSwgY2FudmFzKSB7XHJcbiAgICB2YXIgJGNhbnZhcyA9ICQoY2FudmFzKVxyXG4gICAgJCgnLmNhbnZhcy1jb250YWluZXInKS5oZWlnaHQoJGNhbnZhcy5wYXJlbnQoKS53aWR0aCgpKVxyXG5cclxuICAgIGNhbnZhcy53aWR0aCA9ICRjYW52YXMucGFyZW50KCkud2lkdGgoKVxyXG4gICAgY2FudmFzLmhlaWdodCA9ICRjYW52YXMucGFyZW50KCkud2lkdGgoKVxyXG59KVxyXG4uZmlsdGVyKCcjaW1hZ2UtY2FudmFzJylcclxuLy8gRW5hYmxlcyBhIGNsaWNrLWFuZC1kcmFnIHN0eWxlIG9uIHRoZSBjYW52YXMgZm9yIG1vdmluZyB0aGUgaW1hZ2VcclxuLm1vdXNlZG93bihmdW5jdGlvbigpIHtpc01vdXNlZG93biA9IHRydWV9KVxyXG4ubW91c2V1cChmdW5jdGlvbigpIHtpc01vdXNlZG93biA9IGZhbHNlfSlcclxuLm1vdXNlbW92ZShmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgIGlmIChkeUltYWdlLmltYWdlICYmIGlzTW91c2Vkb3duKSB7XHJcbiAgICAgICAgZHlJbWFnZS54ICs9IGRpZmYoZXZlbnQuY2xpZW50WCwgZHlJbWFnZS5wcmV2WClcclxuICAgICAgICBkeUltYWdlLnkgKz0gZGlmZihldmVudC5jbGllbnRZLCBkeUltYWdlLnByZXZZKVxyXG4gICAgICAgIGR5SW1hZ2UuZHJhdygpXHJcbiAgICB9XHJcblxyXG4gICAgZHlJbWFnZS5wcmV2WCA9IGV2ZW50LmNsaWVudFhcclxuICAgIGR5SW1hZ2UucHJldlkgPSBldmVudC5jbGllbnRZXHJcbn0pXHJcblxyXG4vLyBPbmNlIGFuIGltYWdlIGhhcyBiZWVuIGFjY2VwdGVkLCB3ZSBjcmVhdGUgYW4gaW1hZ2Ugb2JqZWN0LCBhbmQgb25jZSB0aGUgXHJcbi8vIGltYWdlIGhhcyBsb2FkZWQgcnVuIG9uSW1hZ2VMb2FkIGZ1bmN0aW9uXHJcbiQoJyNmaWxlJykuY2hhbmdlKGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgdmFyIGZpbGUgPSBldmVudC50YXJnZXQuZmlsZXNbMF1cclxuICAgIHZhciBpbWFnZSA9IG5ldyBJbWFnZSgpXHJcbiAgICBpbWFnZS5vbmxvYWQgPSBvbkltYWdlTG9hZFxyXG4gICAgaW1hZ2Uuc3JjID0gVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlKVxyXG59KVxyXG5cclxuZnVuY3Rpb24gb25JbWFnZUxvYWQgKCkge1xyXG4gICAgdmFyIGNhbnZhcyAgICAgICA9ICQoJyNpbWFnZS1jYW52YXMnKVswXVxyXG4gICAgICAsICRjYW52YXMgICAgICA9ICQoJ2NhbnZhcycpXHJcbiAgICAgICwgY2FudmFzV2lkdGggID0gJGNhbnZhcy53aWR0aCgpXHJcbiAgICAgICwgY2FudmFzSGVpZ2h0ID0gJGNhbnZhcy5oZWlnaHQoKVxyXG5cclxuICAgIGR5SW1hZ2UgPSBuZXcgRHlJbWFnZSgpXHJcblxyXG4gICAgZHlJbWFnZS5pbWFnZSA9IHRoaXNcclxuICAgIGR5SW1hZ2UuY2FudmFzID0gY2FudmFzXHJcbiAgICBkeUltYWdlLmNoYW5nZVNpemUodGhpcy53aWR0aCwgdGhpcy5oZWlnaHQsIGNhbnZhc1dpZHRoKVxyXG4gICAgZHlJbWFnZS55ID0gTWF0aC5mbG9vcigoY2FudmFzSGVpZ2h0IC8gMikgLSAoZHlJbWFnZS5oZWlnaHQgLyAyKSlcclxuICAgIGR5SW1hZ2UueCA9IE1hdGguZmxvb3IoKGNhbnZhc1dpZHRoICAvIDIpIC0gKGR5SW1hZ2Uud2lkdGggIC8gMikpXHJcbiAgICBkeUltYWdlLmRyYXcoKVxyXG5cclxuICAgICQoJyNvcGFjaXR5LWxhYmVsJykudGV4dCgnT3BhY2l0eTogMTAwJScpXHJcblxyXG4gICAgLy8gYWxsIGltYWdlIHNldHRpbmdzIGluaXRpYWxpc2F0aW9uIFxyXG4gICAgJCgnLnNldHRpbmcnKS5lYWNoKGZ1bmN0aW9uIChfLCBlbGVtZW50KSB7XHJcbiAgICAgICAgZWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlXHJcbiAgICB9KVxyXG4gICAgLy8gTWFuaXB1bGF0aW5nIHRoZSBpbWFnZSdzIHNpemVcclxuICAgIC8vIGV2ZW50IGZ1bmN0aW9ucyB0aGlzIHZhbHVlIGFyZSBjaGFuZ2UgdG8gdGhlIGltYWdlLCB0byBhY2Nlc3MgdGhlIGltYWdlJ3NcclxuICAgIC8vIHdpZHRoXHJcbiAgICAuZmlsdGVyKCcjc2l6ZScpLmVhY2goZnVuY3Rpb24gKF8sIHNpemUpIHtcclxuICAgICAgICB2YXIgd2lkdGggID0gdGhpcy53aWR0aFxyXG4gICAgICAgICAgLCBkV2lkdGggPSBkeUltYWdlLndpZHRoXHJcbiAgICAgICAgc2l6ZS5taW4gPSB3aWR0aCAqIDAuMVxyXG4gICAgICAgIGlmIChkV2lkdGggPiB3aWR0aCkge1xyXG4gICAgICAgICAgICBzaXplLm1heCA9IGRXaWR0aFxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNpemUubWF4ID0gdGhpcy5oZWlnaHRcclxuICAgICAgICB9XHJcbiAgICAgICAgc2l6ZS52YWx1ZSA9IGRXaWR0aFxyXG4gICAgICAgIGNoYW5nZVBlcmNlbnRhZ2UoJyNzaXplLWxhYmVsJywgJ3NpemU6ICcsICh0aGlzLndpZHRoIC8gZFdpZHRoKSlcclxuXHJcbiAgICB9LmJpbmQodGhpcykpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQudmFsdWVcclxuICAgICAgICAgICwgb2xkV2lkdGggPSBkeUltYWdlLndpZHRoXHJcbiAgICAgICAgICAsIG9sZEhlaWdodCA9IGR5SW1hZ2UuaGVpZ2h0XHJcblxyXG4gICAgICAgIGR5SW1hZ2UuY2hhbmdlU2l6ZSh0aGlzLndpZHRoLCB0aGlzLmhlaWdodCwgdGFyZ2V0KVxyXG4gICAgICAgIGR5SW1hZ2UueCAtPSBkaWZmKGR5SW1hZ2Uud2lkdGgsIG9sZFdpZHRoKSAgIC8gMlxyXG4gICAgICAgIGR5SW1hZ2UueSAtPSBkaWZmKGR5SW1hZ2UuaGVpZ2h0LCBvbGRIZWlnaHQpIC8gMlxyXG4gICAgICAgIGR5SW1hZ2UuZHJhdygpXHJcblxyXG4gICAgICAgIGNoYW5nZVBlcmNlbnRhZ2UoJyNzaXplLWxhYmVsJywgJ3NpemU6ICcsICh0YXJnZXQgLyB0aGlzLndpZHRoKSlcclxuICAgIH0uYmluZCh0aGlzKSlcclxuICAgIC8vIE1hbmlwdWxhdGluZyB0aGUgaW1hZ2UncyBvcGFjaXR5XHJcbiAgICAuZW5kKCkuZmlsdGVyKCcjb3BhY2l0eScpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHZhciBuZXdPcGFjaXR5ID0gZXZlbnQudGFyZ2V0LnZhbHVlXHJcbiAgICAgICAgJCgnI29wYWNpdHktbGFiZWwnKS50ZXh0KCdPcGFjaXR5OiAnICsgTWF0aC5mbG9vcihuZXdPcGFjaXR5ICogMTAwKSArICclJylcclxuICAgICAgICBkeUltYWdlLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpLmdsb2JhbEFscGhhID0gbmV3T3BhY2l0eVxyXG4gICAgICAgIGR5SW1hZ2UuZHJhdygpXHJcbiAgICB9KVxyXG4gICAgLy8gTWFuaXB1bGF0aW5nIHRoZSBpbWFnZSdzIGZpbHRlclxyXG4gICAgLmVuZCgpLmZpbHRlcignI2ZpbHRlcicpLmNoYW5nZShmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICB2YXIgJGNhbnZhcyA9ICQoJyNmaWx0ZXItY2FudmFzJylcclxuICAgICAgICAgICwgY29udGV4dCA9ICRjYW52YXNbMF0uZ2V0Q29udGV4dCgnMmQnKVxyXG5cclxuICAgICAgICBjb250ZXh0LmZpbGxTdHlsZSA9IGV2ZW50LnRhcmdldC52YWx1ZVxyXG4gICAgICAgIGNvbnRleHQuZmlsbFJlY3QoMCwgMCwgY2FudmFzV2lkdGgsIGNhbnZhc0hlaWdodClcclxuICAgIH0pXHJcbiAgICAvLyBNYW5pcHVsYXRpbmcgdGhlIGZpbHRlciBjbGVhciBidXR0b25cclxuICAgIC5lbmQoKS5maWx0ZXIoJyNjbGVhcicpLmNsaWNrKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBjb250ZXh0ID0gJCgnI2ZpbHRlci1jYW52YXMnKVswXS5nZXRDb250ZXh0KCcyZCcpXHJcbiAgICAgICAgY29udGV4dC5jbGVhclJlY3QoMCwgMCwgY2FudmFzV2lkdGgsIGNhbnZhc0hlaWdodClcclxuICAgIH0pXHJcbiAgICAvLyBNYW5pcHVsYXRpbmcgdGhlIGltYWdlJ3MgZmlsdGVyJ3Mgb3BhY2l0eVxyXG4gICAgLmVuZCgpLmZpbHRlcignI2ZpbHRlci1vcGFjaXR5JykuZWFjaChmdW5jdGlvbiAoXywgZmlsdGVyKSB7XHJcbiAgICAgICAgdmFyIGFscGhhID0gZmlsdGVyLnZhbHVlXHJcbiAgICAgICAgJCgnI2ZpbHRlci1jYW52YXMnKVswXS5nZXRDb250ZXh0KCcyZCcpLmdsb2JhbEFscGhhID0gYWxwaGFcclxuICAgICAgICBjaGFuZ2VQZXJjZW50YWdlKCcjZmlsdGVyLW9wYWNpdHktbGFiZWwnLCAnQ29sb3VyIE9wYWNpdHk6ICcsIGFscGhhKVxyXG5cclxuICAgIH0pLm9uKCdpbnB1dCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHZhciAkY2FudmFzID0gJCgnI2ZpbHRlci1jYW52YXMnKVxyXG4gICAgICAgICAgLCBjb250ZXh0ID0gJGNhbnZhc1swXS5nZXRDb250ZXh0KCcyZCcpXHJcbiAgICAgICAgICAsIGFscGhhID0gZXZlbnQudGFyZ2V0LnZhbHVlXHJcbiAgICAgICAgY29udGV4dC5nbG9iYWxBbHBoYSA9IGFscGhhXHJcbiAgICAgICAgY29udGV4dC5jbGVhclJlY3QoMCwgMCwgY2FudmFzV2lkdGgsIGNhbnZhc0hlaWdodClcclxuICAgICAgICBjb250ZXh0LmZpbGxSZWN0KDAsIDAsIGNhbnZhc1dpZHRoLCBjYW52YXNIZWlnaHQpXHJcbiAgICAgICAgY2hhbmdlUGVyY2VudGFnZSgnI2ZpbHRlci1vcGFjaXR5LWxhYmVsJywgJ0NvbG91ciBPcGFjaXR5OiAnLCBhbHBoYSlcclxuICAgIH0pXHJcbiAgICAvLyBEcmF3cyB0aGUgdHdvIGNhbnZhcycgb250byBhIHNlY3JldCBjYW52YXMsIGFuZCB0YWtlcyB0aGUgaGlkZGVuIGNhbnZhc1xyXG4gICAgLy8gYXMgYSBzaW5nbGUgaW1hZ2UsIGFuZCB1cGxvYWRzIGl0IHRvIHRoZSBzZXJ2ZXIuIFxyXG4gICAgLmVuZCgpLmZpbHRlcignI3VwbG9hZCcpLmNsaWNrKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBjYW52YXNlcyA9ICQoJy5jYW52YXMnKVxyXG4gICAgICAgICAgLCBoaWRkZW5DYW52YXMgPSAkKCcjaGlkZGVuLWNhbnZhcycpWzBdXHJcbiAgICAgICAgICAsIGhpZGRlbkNvbnRleHQgPSBoaWRkZW5DYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2FudmFzZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaGlkZGVuQ29udGV4dC5kcmF3SW1hZ2UoY2FudmFzZXNbaV0sIDAsIDApXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBpbWFnZSA9IGhpZGRlbkNhbnZhcy50b0RhdGFVUkwoKVxyXG4gICAgICAgIHZhciB1c2VyID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXInKVxyXG4gICAgICAgIHZhciB0YWdzID0gJCgnI3RhZ3MnKS52YWwoKS5yZXBsYWNlKC8gL2csICcnKS5zcGxpdCgnLCcpLmZpbHRlcihCb29sZWFuKVxyXG5cclxuICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICB1cmw6ICcvdXNlcnMvJyt1c2VyLFxyXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgZGF0YToge2ltYWdlOiBpbWFnZSwgdGFnczogdGFnc30sXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9ICcvJ1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgIH0pXHJcbn1cclxuXHJcbi8vIFJldHVybnMgdGhlIGNvcnJlY3QgY29vcmRpbmF0ZSBkaWZmZXJlbmNlIGZvciBtb3ZpbmcgYW4gaW1hZ2Ugd2l0aCBhIG1vdXNlLFxyXG4vLyBhbmQgcmVzaXppbmcgdGhlIGltYWdlIGZyb20gaXQncyBjZW50cmUuXHJcbmZ1bmN0aW9uIGRpZmYgKGEsIGIpIHtcclxuICAgIGlmIChhID4gYikge1xyXG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKGEgLSBiKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcigtKGIgLSBhKSlcclxuICAgIH1cclxufVxyXG4vLyBDaGFuZ2UgdGhlIHBlcmNlbnRhZ2UgdGV4dCBvZiBhbiBlbGVtZW50XHJcbmZ1bmN0aW9uIGNoYW5nZVBlcmNlbnRhZ2UgKGVsZW1lbnQsIHRleHQsIHZhbHVlKSB7XHJcbiAgICB2YXIgcGVyY2VudGFnZSA9IE1hdGguZmxvb3IodmFsdWUgKiAxMDApXHJcbiAgICAkKGVsZW1lbnQpLnRleHQodGV4dCArIHBlcmNlbnRhZ2UgKyAnJScpXHJcbn1cbi8vIEltYWdlIGNsYXNzIGZvciBoYW5kbGluZyBtb3ZpbmcsIGFuZCBjaGFuZ2luZyB0aGUgaW1hZ2UncyBzaXplIGR5bmFtaWNhbGx5XHJcbi8vIHdpdGhpbiB0aGUgY2FudmFzLlxyXG5mdW5jdGlvbiBEeUltYWdlIChpbWFnZSkge1xyXG5cdHRoaXMuaW1hZ2UgPSBpbWFnZVxyXG5cdHRoaXMuY2FudmFzID0gbnVsbFxyXG5cdHRoaXMueCA9IDBcclxuXHR0aGlzLnkgPSAwXHJcblx0dGhpcy5wcmV2WCA9IDBcclxuXHR0aGlzLnByZXZZID0gMFxyXG5cdHRoaXMud2lkdGggPSAwXHJcblx0dGhpcy5oZWlnaHQgPSAwXHJcbn1cclxuLy8gU2NhbGVzIHRoZSBpbWFnZSBzbyB0aGF0IGl0IGxvb2tzIG5pY2Ugd2l0aGluIHRoZSBjYW52YXMuXHJcbi8vIEJyaW5ncyB0aGUgaGVpZ2h0IGRvd24gdG8gdGhlIGhlaWdodCBvZiB0aGUgY2FudmFzLlxyXG5EeUltYWdlLnByb3RvdHlwZS5jaGFuZ2VTaXplID0gZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQsIHRhcmdldCkge1xyXG5cdGlmICh0YXJnZXQgPiB3aWR0aCAmJiB0YXJnZXQgPiBoZWlnaHQpIHtcclxuXHRcdHRoaXMud2lkdGggPSB0aGlzLmltYWdlLndpZHRoXHJcblx0XHR0aGlzLmhlaWdodCA9IHRoaXMuaW1hZ2UuaGVpZ2h0XHJcblx0XHRyZXR1cm47XHJcblx0fVxyXG5cclxuXHR2YXIgYXNwZWN0UmF0aW8gPSBoZWlnaHQgLyB3aWR0aFxyXG5cdCAgLCBuZXdIZWlnaHQgICA9IE1hdGguY2VpbChhc3BlY3RSYXRpbyAqIHRhcmdldClcclxuXHJcblx0aWYgKG5ld0hlaWdodCA8IHRhcmdldCkge1xyXG5cdFx0dmFyIG5ld0FzcGVjdFJhdGlvID0gd2lkdGggLyBoZWlnaHRcclxuXHRcdCAgLCBuZXdXaWR0aCA9IE1hdGguY2VpbChuZXdBc3BlY3RSYXRpbyAqIHRhcmdldClcclxuXHJcblx0XHR0aGlzLndpZHRoID0gbmV3V2lkdGhcclxuXHRcdHRoaXMuaGVpZ2h0ID0gdGFyZ2V0XHJcblx0XHJcblx0fSBlbHNlIHtcclxuXHRcdHRoaXMud2lkdGggPSB0YXJnZXRcclxuXHRcdHRoaXMuaGVpZ2h0ID0gbmV3SGVpZ2h0XHJcblx0fVxyXG59XHJcblxyXG4vLyBzZXQgdGhlIHgsIGFuZCB5IHBvc2l0aW9uIG9mIHRoZSBpbWFnZVxyXG5EeUltYWdlLnByb3RvdHlwZS5zZXRQb3MgPSBmdW5jdGlvbih4LCB5KSB7XHJcblx0dGhpcy54ID0geFxyXG5cdHRoaXMueSA9IHlcclxufVxyXG5cclxuLy8gRHJhdyB0aGUgaW1hZ2Ugb24gdG8gdGhlIGNhbnZhcywgd2l0aCBhbiBvcHRpb24gdG8gb3ZlcnJpZGUgdGhlIHgsIHksIHdpZHRoLFxyXG4vLyBhbmQgaGVpZ2h0IGF0dHJpYnV0ZXNcclxuRHlJbWFnZS5wcm90b3R5cGUuZHJhdyA9IGZ1bmN0aW9uKHgsIHksIHdpZHRoLCBoZWlnaHQpIHtcclxuXHR4ID0geCB8fCB0aGlzLnhcclxuXHR5ID0geSB8fCB0aGlzLnlcclxuXHR3aWR0aCA9IHdpZHRoIHx8IHRoaXMud2lkdGhcclxuXHRoZWlnaHQgPSBoZWlnaHQgfHwgdGhpcy5oZWlnaHRcclxuXHJcblx0dmFyICRjYW52YXMgPSAkKHRoaXMuY2FudmFzKVxyXG5cdCAgLCBjb250ZXh0ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxyXG4gICAgY29udGV4dC5jbGVhclJlY3QoMCwgMCwgJGNhbnZhcy53aWR0aCgpLCAkY2FudmFzLmhlaWdodCgpKVxyXG4gICAgY29udGV4dC5kcmF3SW1hZ2UodGhpcy5pbWFnZSwgeCwgeSwgd2lkdGgsIGhlaWdodClcclxufTtcbiQoJyNyZWdpc3RlcicpLmNsaWNrKGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxyXG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKClcclxuICAgIHZhciBkYXRhXHJcbiAgICAgICwgdXNlcm5hbWUgPSAkKCcudXNlcm5hbWUnKS52YWwoKVxyXG4gICAgICAsIHBhc3N3b3JkID0gJCgnLnBhc3N3b3JkJykudmFsKClcclxuICAgICAgLCBjb25maXJtICA9ICQoJy5jb25maXJtJykudmFsKClcclxuXHJcbiAgICBpZiAoY29uZmlybSAhPSBwYXNzd29yZCkge1xyXG4gICAgICAkKCcjZXJyb3InKS52YWwoJ3Bhc3N3b3JkcyBkb25cXCd0IG1hdGNoLicpXHJcbiAgICB9XHJcblxyXG4gICAgZGF0YSA9IHsgdXNlcm5hbWUgOiB1c2VybmFtZVxyXG4gICAgICAgICAgICwgcGFzc3dvcmQgOiBwYXNzd29yZFxyXG4gICAgICAgICAgICwgY29uZmlybSA6IGNvbmZpcm1cclxuICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICQuYWpheCh7XHJcbiAgICAgICAgdXJsOiAnL3VzZXJzL3JlZ2lzdGVyJyxcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICBkYXRhOiBkYXRhLFxyXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd1c2VyJywgZGF0YSlcclxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gJy8nXHJcbiAgICAgICAgfSwgXHJcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICAkKCcjZXJyb3InKS52YWwoJ0Vycm9yIHJlZ2lzdGVyaW5nJylcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG59KVxyXG5cclxuJCgnI2xvZ2luJykuY2xpY2soZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXHJcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKVxyXG4gICAgdmFyIGRhdGFcclxuICAgICAgLCB1c2VybmFtZSA9ICQoJy51c2VybmFtZScpLnZhbCgpXHJcbiAgICAgICwgcGFzc3dvcmQgPSAkKCcucGFzc3dvcmQnKS52YWwoKVxyXG5cclxuICAgICAgICBkYXRhID0geyB1c2VybmFtZTogdXNlcm5hbWVcclxuICAgICAgICAgICAgICAgLCBwYXNzd29yZDogcGFzc3dvcmRcclxuICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICQuYWpheCh7XHJcbiAgICAgICAgdXJsOiAnL3VzZXJzL2xvZ2luJyxcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICBkYXRhOiBkYXRhLFxyXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd1c2VyJywgZGF0YSlcclxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gJy8nXHJcbiAgICAgICAgfSwgXHJcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkKCcjZXJyb3InKS52YWwoJ05vIHVzZXIgd2l0aCB0aGF0IHVzZXJuYW1lLCBvciBwYXNzd29yZCBleGlzdHMuJylcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG59KVxyXG5cclxuZnVuY3Rpb24gdmFsaWRVc2VyKGVycm9yLCBzdWNjZXNzKSB7XHJcbiAgICB2YXIgdXNlcklkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXInKVxyXG4gICAgaWYgKCF1c2VySWQpIHtcclxuICAgICAgICBlcnJvcigpXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgIHVybDogJy91c2Vycy92YWxpZGF0ZScsXHJcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICBkYXRhOiB7aWQ6IHVzZXJJZH0sXHJcbiAgICAgICAgICAgIGVycm9yOiBlcnJvcixcclxuICAgICAgICAgICAgc3VjY2Vzczogc3VjY2Vzc1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcbn1cbiQoJy5pbWFnZScpLmNsaWNrKGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgdmFyICRpbWFnZSA9ICQoZXZlbnQudGFyZ2V0KVxyXG4gICAgdmFyIHRhZ3MgPSAkaW1hZ2UuZGF0YSgndGFncycpLnJlcGxhY2UoLyAvZywgJycpLnNwbGl0KCcsJykuZmlsdGVyKEJvb2xlYW4pXHJcbiAgICAkKCcjdGFnLWxpc3RpbmcnKS5lbXB0eSgpXHJcbiAgICB0YWdzLmZvckVhY2goZnVuY3Rpb24gKHRhZyl7XHJcbiAgICAgICAgJCgnI3RhZy1saXN0aW5nJykuYXBwZW5kKCc8YSBjbGFzcz1cInR3ZWx2ZSBjb2x1bW5zXCIgaHJlZj1cIi90YWdzLycrdGFnKydcIj48aDQ+Jyt0YWcrJzwvaDQ+PC9hPicpXHJcbiAgICB9KTtcclxufSlcclxuXHJcbnZhbGlkVXNlcihmdW5jdGlvbigpIHtcclxuICAgICQoJyN1cGxvYWQtYnV0dG9uJykucmVtb3ZlKClcclxufSxcclxuZnVuY3Rpb24oKSB7XHJcbiAgICAkKCcjdXNlci1idXR0b25zJykucmVtb3ZlKClcclxufSlcbn0pKCQsIHdpbmRvdywgZG9jdW1lbnQpIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
